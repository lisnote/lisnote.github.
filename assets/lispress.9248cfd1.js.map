{"version":3,"file":"lispress.9248cfd1.js","sources":["../../node_modules/lispress/dist/lispress.js"],"sourcesContent":["function config (obj = {}) {\r\n    if (Reflect.has(obj, 'username')) {\r\n        config$1.username = obj.username;\r\n    }\r\n    else if (config$1.username == null) {\r\n        config$1.username = getUsername();\r\n    }\r\n    config$1 = Object.assign(Object.assign(Object.assign({}, init(config$1.username)), config$1), obj);\r\n    return config$1;\r\n}\r\n// data container\r\nlet config$1 = {};\r\n// init data\r\nfunction init(username) {\r\n    return {\r\n        articles: `https://api.github.com/repos/${username}/${username}.github.io/contents/articles`,\r\n        article: `https://${username}.github.io/articles/{title}`,\r\n        background: `https://${username}.github.io/articles/assets/{title}/background.jpg`,\r\n        avatar: `https://avatars.githubusercontent.com/${username}`,\r\n    };\r\n}\r\n// get username from host\r\nfunction getUsername() {\r\n    let username;\r\n    let index = location.host.indexOf('.github.io');\r\n    if (index == -1) {\r\n        console.error('Failed to obtain username,please set the username before using it.');\r\n        return 'lisnote';\r\n    }\r\n    username = location.host.substring(0, index);\r\n    return username;\r\n}\n\nfunction getArticleContent (title) {\r\n    return fetch(config().article.replace(/\\{title\\}/g, title))\r\n        .then((resp) => resp.text());\r\n}\n\nfunction getArticles() {\r\n    return fetch(config().articles, {\r\n        headers: {\r\n            authorization: 'Basic ' + btoa(config().clientID + ':' + config().clientSecret),\r\n        },\r\n    })\r\n        .then((resp) => resp.json())\r\n        .then((json) => {\r\n        return json\r\n            .map((obj) => obj.name)\r\n            .filter((obj) => obj != 'index.html' && obj != 'assets');\r\n    });\r\n}\r\nfunction getDateMap() {\r\n    let dateMap = {};\r\n    return fetch(`https://api.github.com/search/code?q=date%20user:${config().username}%20path:articles/%20language:markdown`, {\r\n        headers: {\r\n            Accept: 'application/vnd.github.v3.text-match+json',\r\n            authorization: 'Basic ' + btoa(config().clientID + ':' + config().clientSecret),\r\n        },\r\n    })\r\n        .then((resp) => resp.json())\r\n        .then((result) => {\r\n        try {\r\n            result = result.items.filter((element) => {\r\n                return !/articles\\/.*\\//.test(element.path);\r\n            });\r\n            result.forEach((element) => {\r\n                try {\r\n                    dateMap[element.name] = Number(element.text_matches[0].fragment\r\n                        .match(/\\d{4}(-\\d{2}){2} \\d{2}(:\\d{2}){2}/)[0]\r\n                        .replace(/-| |:/g, ''));\r\n                }\r\n                catch (_a) {\r\n                    dateMap[element.name] = 0;\r\n                }\r\n            });\r\n            return dateMap;\r\n        }\r\n        catch (e) {\r\n            console.error(\"Sort failed, API rate limit exceeded.\");\r\n            return {};\r\n        }\r\n    });\r\n}\r\nvar common = {\r\n    getArticles,\r\n    getDateMap,\r\n};\n\nfunction getArticlesTitle () {\r\n    let titles;\r\n    let dateMap;\r\n    let getarticles = common\r\n        .getArticles()\r\n        .then((thatTitles) => (titles = thatTitles));\r\n    let getDateMap = common\r\n        .getDateMap()\r\n        .then((thatDateMap) => (dateMap = thatDateMap));\r\n    return Promise.all([getarticles, getDateMap]).then(() => {\r\n        titles.sort((x, y) => {\r\n            return dateMap[y] - dateMap[x];\r\n        });\r\n        return titles;\r\n    });\r\n}\n\nfunction getBackgroundUrl (title) {\r\n    return config().background.replace(/\\{title\\}/g, title);\r\n}\n\nfunction getSearchArticlesTitle (keywords) {\r\n    let titles;\r\n    let dateMap;\r\n    let getarticles = common\r\n        .getArticles()\r\n        .then((thatTitles) => (titles = thatTitles));\r\n    let getDateMap = common\r\n        .getDateMap()\r\n        .then((thatDateMap) => (dateMap = thatDateMap));\r\n    return Promise.all([getarticles, getDateMap]).then(() => {\r\n        let promises = [];\r\n        let filter = [];\r\n        for (let title of titles) {\r\n            let promise = getArticleContent(title)\r\n                .then((article) => {\r\n                if (hasKeywords(keywords, title, article)) {\r\n                    filter.push(title);\r\n                }\r\n            });\r\n            promises.push(promise);\r\n        }\r\n        return Promise.all(promises).then(() => {\r\n            filter.sort((x, y) => {\r\n                return dateMap[y] - dateMap[x];\r\n            });\r\n            return filter;\r\n        });\r\n    });\r\n    function hasKeywords(keywords, title, article) {\r\n        for (let keyword of keywords) {\r\n            if (title.indexOf(keyword) < 0 && article.indexOf(keyword) < 0) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}\n\nfunction setAvatar (selector) {\r\n    document.querySelectorAll(selector).forEach((obj) => {\r\n        obj.setAttribute('src', config().avatar);\r\n    });\r\n}\n\nfunction setGithubUrl (selector) {\r\n    document.querySelectorAll(selector).forEach((obj) => {\r\n        obj.setAttribute('href', `https://github.com/${config().username}`);\r\n    });\r\n}\n\nfunction setUsername (selector) {\r\n    document.querySelectorAll(selector).forEach((obj) => {\r\n        obj.innerText = config().username;\r\n    });\r\n}\n\nvar index = {\r\n    config,\r\n    getArticleContent,\r\n    getArticlesTitle,\r\n    getBackgroundUrl,\r\n    getSearchArticlesTitle,\r\n    setAvatar,\r\n    setGithubUrl,\r\n    setUsername,\r\n};\n\nexport { index as default };\n"],"names":[],"mappings":"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"}